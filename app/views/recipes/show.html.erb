<div class="card shadow-sm mb-4">
  <% if @recipe.image.attached? %>
    <%= image_tag @recipe.image, class: "card-img-top", alt: @recipe.title %>
  <% end %>
  <div class="card-body">
    <h1 class="card-title text-primary fw-bold"><%= @recipe.title %></h1>
    <div class="mb-3">
      <%= render "likes/like_button", recipe: @recipe %>
    </div>
    <p class="mt-3"><strong>材料/作り方:</strong></p>
    <p class="card-text"><%= simple_format(@recipe.body) %></p>
    <p class="text-muted small mb-1">投稿者: <%= @recipe.user.name %></p>
    <p class="text-muted small">投稿日: <%= @recipe.created_at.strftime("%Y-%m-%d") %></p>
    <p class="mt-3">
      <strong>タグ:</strong>
      <% @recipe.tags.each do |tag| %>
        <%= link_to tag.name, tag_path(tag), class: "badge bg-badge me-1" %>
      <% end %>
    </p>
    <% if @recipe.user == current_user %>
      <div class="mt-3">
        <%= link_to "編集", edit_recipe_path(@recipe), class: "btn btn-outline-info btn-sm me-2" %>
        <%= link_to "削除", recipe_path(@recipe), method: :delete, class: "btn btn-outline-danger btn-sm" %>
      </div>
    <% end %>
  </div>
</div>
<hr>
<h3 class="fw-bold mb-3">コメント</h3>
<% if @recipe.comments.any? %>
  <% @recipe.comments.each do |comment| %>
  <% end %>
<% else %>
  <p class="text-muted">まだコメントはありません。</p>
<% end %>
<% @recipe.comments.each do |comment| %>
  <div class="border rounded p-3 mb-3 bg-white shadow-sm">
    <p><%= simple_format(comment.body) %></p>
    <small class="text-muted">
      by <%= comment.user.name %> | <%= comment.created_at.strftime("%Y-%m-%d") %>
    </small>
    <% if comment.user == current_user %>
      <div class="mt-2">
        <%= link_to "削除", recipe_comment_path(@recipe, comment), method: :delete, class: "btn btn-outline-danger btn-sm" %>
      </div>
    <% end %>
  </div>
<% end %>
<% if user_signed_in? %>
  <%= form_with(model: [@recipe, Comment.new], local: true) do |f| %>
    <div class="mb-3">
      <%= f.text_area :body, class: "form-control", rows: 3 %>
    </div>
    <div class="d-grid mt-2">
      <%= f.submit "コメント投稿", class: "btn btn-primary" %>
    </div>
  <% end %>
<% else %>
  <p><%= link_to "ログイン", new_user_session_path, class: "btn btn-outline-primary" %></p>
<% end %>
<hr>
<%= link_to "一覧に戻る", recipes_path, class: "btn btn-outline-secondary" %>