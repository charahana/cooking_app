<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">レシピ一覧</h2>
    <% if user_signed_in? %>
      <%= link_to "新しいレシピを投稿する", new_recipe_path, class: "btn btn-warning mb-3" %>
    <% else %>
      <%= link_to "ログインしてレシピを投稿する", new_user_session_path, class: "btn btn-outline-warning mb-3" %>
    <% end %>
  </div>
  <div class="row">
    <% @recipes.each do |recipe| %>
      <%# 下書きは自分以外には表示しない %>
      <% next if recipe.draft? && recipe.user != current_user %>
      <%# 下書きかどうかでカード背景色を変える %>
      <% card_bg_class = recipe.draft? ? "bg-secondary text-white" : "bg-white text-dark" %>
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm <%= card_bg_class %>">
          <% if recipe.image.attached? %>
            <%= image_tag recipe.image.variant(resize_to_fill: [400, 250]).processed, class: "card-img-top", alt: recipe.title %>
          <% else %>
            <%= image_tag "no_image.jpg", class: "card-img-top", alt: "no image", style: "width: 100%; height: 250px; object-fit: cover;" %>
          <% end %>
          <div class="card-body">
            <h5 class="card-title d-flex justify-content-between align-items-center"><%= link_to recipe.title, recipe_path(recipe), class: "text-decoration-none text-primary fw-bold" %><% if recipe.draft? && recipe.user == current_user %><span class="badge bg-warning text-dark">下書き</span><% end %></h5>
            <p class="card-text text-muted small mb-2">by <%= recipe.user.name %></p>
            <div class="mt-2">
              <%= render "likes/like_button", recipe: recipe %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>